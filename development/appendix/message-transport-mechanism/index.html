
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Contributors to the Shapeshifter project" name="author"/>
<link href="http://localhost:8000/development/appendix/message-transport-mechanism/" rel="canonical"/>
<link href="../flex-reservation-mechanism/" rel="prev"/>
<link href="../bibliography/" rel="next"/>
<link href="../../assets/images/shapeshifter-icon-color.svg" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.7" name="generator"/>
<title>Message transport mechanism - Shapeshifter specification</title>
<link href="../../assets/stylesheets/main.8608ea7d.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
 <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#message-transport-mechanism">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-color-scheme="default" data-md-component="outdated" hidden="">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Shapeshifter specification" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Shapeshifter specification">
<img alt="logo" src="../../assets/images/shapeshifter-icon-white.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Shapeshifter specification
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Message transport mechanism
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/shapeshifter/shapeshifter-specification" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<a class="md-header__button md-header-nav__button md-icon" href="../../pdf/document.pdf" title="PDF">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
<path d="M128,0c-17.6,0-32,14.4-32,32v448c0,17.6,14.4,32,32,32h320c17.6,0,32-14.4,32-32V128L352,0H128z" fill="#E2E5E7"></path>
<path d="m384 128h96l-128-128v96c0 17.6 14.4 32 32 32z" fill="#B0B7BD"></path>
<polygon fill="#CAD1D8" points="480 224 384 128 480 128"></polygon>
<path d="M416,416c0,8.8-7.2,16-16,16H48c-8.8,0-16-7.2-16-16V256c0-8.8,7.2-16,16-16h352c8.8,0,16,7.2,16,16  V416z" fill="#F15642"></path>
<g fill="#fff">
<path d="m101.74 303.15c0-4.224 3.328-8.832 8.688-8.832h29.552c16.64 0 31.616 11.136 31.616 32.48 0 20.224-14.976 31.488-31.616 31.488h-21.36v16.896c0 5.632-3.584 8.816-8.192 8.816-4.224 0-8.688-3.184-8.688-8.816v-72.032zm16.88 7.28v31.872h21.36c8.576 0 15.36-7.568 15.36-15.504 0-8.944-6.784-16.368-15.36-16.368h-21.36z"></path>
<path d="m196.66 384c-4.224 0-8.832-2.304-8.832-7.92v-72.672c0-4.592 4.608-7.936 8.832-7.936h29.296c58.464 0 57.184 88.528 1.152 88.528h-30.448zm8.064-72.912v57.312h21.232c34.544 0 36.08-57.312 0-57.312h-21.232z"></path>
<path d="m303.87 312.11v20.336h32.624c4.608 0 9.216 4.608 9.216 9.072 0 4.224-4.608 7.68-9.216 7.68h-32.624v26.864c0 4.48-3.184 7.92-7.664 7.92-5.632 0-9.072-3.44-9.072-7.92v-72.672c0-4.592 3.456-7.936 9.072-7.936h44.912c5.632 0 8.96 3.344 8.96 7.936 0 4.096-3.328 8.704-8.96 8.704h-37.248v0.016z"></path>
</g>
<path d="m400 432h-304v16h304c8.8 0 16-7.2 16-16v-16c0 8.8-7.2 16-16 16z" fill="#CAD1D8"></path>
</svg>
</a></nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Shapeshifter specification" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Shapeshifter specification">
<img alt="logo" src="../../assets/images/shapeshifter-icon-white.svg"/>
</a>
    Shapeshifter specification
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/shapeshifter/shapeshifter-specification" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    USEF Flex Trading Protocol
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    About UFTP
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            About UFTP
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../about/purpose/">
<span class="md-ellipsis">
    Purpose
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../about/scope/">
<span class="md-ellipsis">
    Scope
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../about/levels-of-compliancy/">
<span class="md-ellipsis">
    Levels of compliancy
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../about/reading-guideline/">
<span class="md-ellipsis">
    Reading guideline
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../general-description/">
<span class="md-ellipsis">
    General description
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            General description
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../general-description/usef-general-concepts/">
<span class="md-ellipsis">
    USEF general concepts
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../general-description/contract-phase/">
<span class="md-ellipsis">
    Contract phase
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../general-description/plan-phase/">
<span class="md-ellipsis">
    Plan phase
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../general-description/validate-phase/">
<span class="md-ellipsis">
    Validate phase
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../general-description/operate-phase/">
<span class="md-ellipsis">
    Operate phase
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../general-description/settle-phase/">
<span class="md-ellipsis">
    Settle phase
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Use case descriptions
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Use case descriptions
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-case-descriptions/scope/">
<span class="md-ellipsis">
    Scope
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-case-descriptions/privacy-and-security-by-design/">
<span class="md-ellipsis">
    Privacy and security by design
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-case-descriptions/common-concepts/">
<span class="md-ellipsis">
    Common concepts
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-case-descriptions/reading-guidelines/">
<span class="md-ellipsis">
    Reading guidelines
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-case-descriptions/message-validation/">
<span class="md-ellipsis">
    Message validation
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
<span class="md-ellipsis">
    Use Cases
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
            Use Cases
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-case-descriptions/use-cases/contract-phase/">
<span class="md-ellipsis">
    Contract phase
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-case-descriptions/use-cases/plan-phase/">
<span class="md-ellipsis">
    Plan phase
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-case-descriptions/use-cases/validate-phase/">
<span class="md-ellipsis">
    Validate phase
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-case-descriptions/use-cases/operate-phase/">
<span class="md-ellipsis">
    Operate phase
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-case-descriptions/use-cases/settle-phase/">
<span class="md-ellipsis">
    Settle phase
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Message descriptions
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Message descriptions
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/scope/">
<span class="md-ellipsis">
    Scope
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_2" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/">
<span class="md-ellipsis">
    Message catalog
    
  </span>
</a>
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            Message catalog
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/power/">
<span class="md-ellipsis">
    Power
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/metadata-attributes/">
<span class="md-ellipsis">
    Metadata attributes
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/signed-message/">
<span class="md-ellipsis">
    SignedMessage
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/test-message/">
<span class="md-ellipsis">
    TestMessage
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/test-message-response/">
<span class="md-ellipsis">
    TestMessageResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/agr-portfolio-update/">
<span class="md-ellipsis">
    AGRPortfolioUpdate
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/agr-portfolio-update-response/">
<span class="md-ellipsis">
    AGRPortfolioUpdateResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/agr-portfolio-query/">
<span class="md-ellipsis">
    AGRPortfolioQuery
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/agr-portfolio-query-response/">
<span class="md-ellipsis">
    AGRPortfolioQueryResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/dso-portfolio-update/">
<span class="md-ellipsis">
    DSOPortfolioUpdate
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/dso-portfolio-update-response/">
<span class="md-ellipsis">
    DSOPortfolioUpdateResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/dso-portfolio-query/">
<span class="md-ellipsis">
    DSOPortfolioQuery
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/dso-portfolio-query-response/">
<span class="md-ellipsis">
    DSOPortfolioQueryResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-reservation-update/">
<span class="md-ellipsis">
    FlexReservationUpdate
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-reservation-update-response/">
<span class="md-ellipsis">
    FlexReservationUpdateReponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/d-prognosis/">
<span class="md-ellipsis">
    D-Prognosis
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/d-prognosis-response/">
<span class="md-ellipsis">
    D-PrognosisResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-request/">
<span class="md-ellipsis">
    FlexRequest
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-request-response/">
<span class="md-ellipsis">
    FlexRequestResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-offer/">
<span class="md-ellipsis">
    FlexOffer
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-offer-response/">
<span class="md-ellipsis">
    FlexOfferResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-offer-revocation/">
<span class="md-ellipsis">
    FlexOfferRevocation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-offer-revocation-response/">
<span class="md-ellipsis">
    FlexOfferRevocationResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-order/">
<span class="md-ellipsis">
    FlexOrder
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-order-response/">
<span class="md-ellipsis">
    FlexOrderResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/metering/">
<span class="md-ellipsis">
    Metering
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/metering-response/">
<span class="md-ellipsis">
    MeteringResponse
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-settlement/">
<span class="md-ellipsis">
    FlexSettlement
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../message-descriptions/message-catalog/flex-settlement-response/">
<span class="md-ellipsis">
    FlexSettlementResponse
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Appendix
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Appendix
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../glossary/">
<span class="md-ellipsis">
    Glossary
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../rationale-for-information-exchange-in-flexibility-request/">
<span class="md-ellipsis">
    Rationale for information exchange in flexiblity request
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../flex-reservation-mechanism/">
<span class="md-ellipsis">
    Flex reservation mechanism
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Message transport mechanism
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Message transport mechanism
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#cryptographic-scheme-cs">
<span class="md-ellipsis">
      Cryptographic Scheme (CS)
    </span>
</a>
<nav aria-label="Cryptographic Scheme (CS)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#message-exchange-logic">
<span class="md-ellipsis">
      Message exchange logic
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#service-discovery">
<span class="md-ellipsis">
      Service discovery
    </span>
</a>
<nav aria-label="Service discovery" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#versioning">
<span class="md-ellipsis">
      Versioning
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#supporting-multiple-versions-of-the-protocol">
<span class="md-ellipsis">
      Supporting multiple versions of the protocol
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#version-coupled-to-url">
<span class="md-ellipsis">
      Version coupled to URL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#messages">
<span class="md-ellipsis">
      Messages
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#service-discovery_1">
<span class="md-ellipsis">
      Service discovery
    </span>
</a>
<nav aria-label="Service discovery" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#single-authority">
<span class="md-ellipsis">
      Single authority
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dns">
<span class="md-ellipsis">
      DNS
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#transmission">
<span class="md-ellipsis">
      Transmission
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling">
<span class="md-ellipsis">
      Error handling
    </span>
</a>
<nav aria-label="Error handling" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#common-message-metadata">
<span class="md-ellipsis">
      Common Message Metadata
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#awaiting-reply">
<span class="md-ellipsis">
      Awaiting reply
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#service-process-message-error-handling">
<span class="md-ellipsis">
      Service process message error handling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ea1-addressing-scheme">
<span class="md-ellipsis">
      EA1 addressing scheme
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../bibliography/">
<span class="md-ellipsis">
    Bibliography
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#cryptographic-scheme-cs">
<span class="md-ellipsis">
      Cryptographic Scheme (CS)
    </span>
</a>
<nav aria-label="Cryptographic Scheme (CS)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#message-exchange-logic">
<span class="md-ellipsis">
      Message exchange logic
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#service-discovery">
<span class="md-ellipsis">
      Service discovery
    </span>
</a>
<nav aria-label="Service discovery" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#versioning">
<span class="md-ellipsis">
      Versioning
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#supporting-multiple-versions-of-the-protocol">
<span class="md-ellipsis">
      Supporting multiple versions of the protocol
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#version-coupled-to-url">
<span class="md-ellipsis">
      Version coupled to URL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#messages">
<span class="md-ellipsis">
      Messages
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#service-discovery_1">
<span class="md-ellipsis">
      Service discovery
    </span>
</a>
<nav aria-label="Service discovery" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#single-authority">
<span class="md-ellipsis">
      Single authority
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dns">
<span class="md-ellipsis">
      DNS
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#transmission">
<span class="md-ellipsis">
      Transmission
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling">
<span class="md-ellipsis">
      Error handling
    </span>
</a>
<nav aria-label="Error handling" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#common-message-metadata">
<span class="md-ellipsis">
      Common Message Metadata
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#awaiting-reply">
<span class="md-ellipsis">
      Awaiting reply
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#service-process-message-error-handling">
<span class="md-ellipsis">
      Service process message error handling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ea1-addressing-scheme">
<span class="md-ellipsis">
      EA1 addressing scheme
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/shapeshifter/shapeshifter-specification/edit/master/docs/appendix/message-transport-mechanism.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
</a>
<!--
SPDX-FileCopyrightText: 2020-2023 Contributors to the Shapeshifter project

SPDX-License-Identifier: Apache-2.0
-->
<h1 id="message-transport-mechanism">Message transport mechanism</h1>
<p>When implementing the USEF best-practice message transfer mechanism, the procedures outlined in this section apply.</p>
<h2 id="cryptographic-scheme-cs">Cryptographic Scheme (CS)</h2>
<p>The USEF privacy and security guidelines require all participants to be able to securely transmit and authenticate messages.
For these purposes, a transport-independent cryptographic scheme is specified, identified as Cryptographic Scheme Type 1 (CS1): implementation is a recommended practice for all implementations<sup id="fnref:13"><a class="footnote-ref" href="#fn:13">1</a></sup>.
Based on NaCl<sup id="fnref:14"><a class="footnote-ref" href="#fn:14">2</a></sup>, a public domain library with high-speed state-of-the-art security features and a purpose-built and straightforward programming interface<sup id="fnref:15"><a class="footnote-ref" href="#fn:15">3</a></sup>, this scheme requires participants to generate two public/private key pairs:</p>
<table>
<thead>
<tr>
<th>Purpose</th>
<th>NaCl function</th>
<th>Private key bits</th>
<th>Public key bits</th>
</tr>
</thead>
<tbody>
<tr>
<td>Digital signatures</td>
<td>crypto_sign_keypair</td>
<td>512</td>
<td>256</td>
</tr>
<tr>
<td>Authenticated message encryption</td>
<td>crypto_box_keypair</td>
<td>256</td>
<td>256</td>
</tr>
</tbody>
</table>
<p>The resulting private keys must be securely stored using an operating system or language-supplied facility for that specific purpose (e.g. the Win32 Data Protection API, OS X Keychain service or JVM KeyStore).
In addition to being stored locally, the public keys are exchanged with other USEF participants.
For that purpose, the keys are joined together in a single 64-byte array (signature key followed by encryption key), Base-64 encoded and prefixed by the constant cs1 and a period (indicating that the version 1 cryptographic scheme is used).
For example: <code>cs1.V4lZrkYHq8FzneXxUML+QEMXMul3tBm+gPGoVDIZBA92VoWTu8/kRu2Zx72XOm1i/qwwoSgXjqSAqSa43myCaQ==</code></p>
<p>This public key string can be published in the DNS zone of the domain used in the associated entity address, or manually exchanged with other USEF participants.
If DNS is used, implementation of DNSSEC is mandatory, as otherwise the key material would be completely untrusted.
Implementations must use a DNSSEC validating resolver, which can either be built-in, or an external resolver on a fully trusted network.</p>
<p>When signing an outgoing message using the private digital signature key and NaCl’s <code>crypto_sign</code> function, the result is an opaque blob: the sealed message.
Unsealing this message, using the corresponding public digital signature key and <code>crypto_sign_open</code>, performs signature verification and returns the message plaintext.
Since this all happens in the same API call, it is not possible to accidentally process an unsigned or incorrectly signed message.</p>
<h3 id="message-exchange-logic">Message exchange logic</h3>
<p>The entire message exchange, from the client’s outgoing message queue to the server’s incoming message queue, using HTTP-over-TLS transport and the default cryptographic scheme, is visualized in detail in the picture below.</p>
<figure>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-type="image" data-width="50vw" href="../../assets/images/image23.emf.odg.svg.png"><img alt="End-to-end USEF message exchange." src="../../assets/images/image23.emf.odg.svg.png" width="1000px"/></a>
</p>
<figcaption>End-to-end USEF message exchange.</figcaption>
</figure>
<p>Messages go through the following stages between retrieval from the client’s outgoing message queue and delivery to the server’s inbound message queue.</p>
<p>To prevent transient Internet connectivity or participant configuration issues from inhibiting message exchange, a retry mechanism could be implemented. The timer value used for such a period should be at least one hour for routine messages.
Note that, although message queue implementations may inform the sending process about delivery delays, only the final success or failure status is authoritative.
When retrying failed requests, the implementation must implement an exponential back off mechanism to prevent undue load on the remote service.</p>
<h2 id="service-discovery">Service discovery</h2>
<h3 id="versioning">Versioning</h3>
<p>For versioning of the specification we use semantic versioning (see <a href="https://semver.org/">https://semver.org/</a>).
In short: MAJOR.MINOR.PATCH. Each new major version is incompatible with previous versions; New minor versions are backwards compatible with previous minor versions within the same major version.</p>
<h3 id="supporting-multiple-versions-of-the-protocol">Supporting multiple versions of the protocol</h3>
<p>DSO’s should be more flexible than AGR’s, so DSO’s will support multiple versions of the protocol, but only for a restricted time.</p>
<p>Also, the CRO should support multiple versions.</p>
<p>DSO's and CRO are expected to support at most the three latest versions.</p>
<h3 id="version-coupled-to-url">Version coupled to URL</h3>
<p>Each major version should have a different url-path, so it is possible to route each incompatible protocol version to another service.
This means that for minor changes and patches the url will remain the same.
The convention for the url-path (by example) is as follows:</p>
<p>version 2.0.0: /shapeshifter/api/v2/message</p>
<p>version 2.1.0: /shapeshifter/api/v2/message</p>
<p>version 3.0.1: /shapeshifter/api/v3/message</p>
<h3 id="messages">Messages</h3>
<p>The metadata of each message contains the specification version.
A rejection reason will be added to reject a message with an invalid version</p>
<h3 id="service-discovery_1">Service discovery</h3>
<p>The purpose of the discovery stage is to discover the endpoint, public-key for signing and, optionally, the capabilities (e.g. supported Shapeshifter versions) of the other participants.<br/>
The requirements for this stage rely heavily on agreements made between the participants that will be communicating with each other using the protocol.</p>
<p>If service discovery fails due to inability to collect all required data within this timeout period, the delivery of the message fails.
Such messages are removed from the outgoing queue and returned to the sending process, indicating a transport error.</p>
<h4 id="single-authority">Single authority</h4>
<p>One possible implementation for service discovery is creating a single authority that administers all the relevant information, and provides this to participants.
This approach could be seen as having a central address book, so all participants know where and how to send messages to each other. </p>
<p>Activities on the energy market are most likely regulated by national oversight bodies. Such organizations are natural candidates for running such a service. Role-wise, this would be handled by the CRO, but in practice it might often be a DSO.</p>
<h4 id="dns">DNS</h4>
<p>Another possible implementation for service discovery is DNS<sup id="fnref:16"><a class="footnote-ref" href="#fn:16">4</a></sup>. 
Assuming the Internet domain name of the remote participant is example.com, the relevant DNS records are as follows:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>_usef.example.com</td>
<td>TXT record specifying the version of the USEF specification implemented by this participant, e.g. <code>2015</code></td>
</tr>
<tr>
<td>_<em>role</em>._usef.example.com</td>
<td>TXT record containing up to two<sup id="fnref:17"><a class="footnote-ref" href="#fn:17">5</a></sup> space-separated Base-64 encoded public key strings for the specified role, where role is one of the values <code>AGR</code>, <code>CRO</code> or <code>DSO</code>. This data is only queried if (part of) the outgoing message needs to be encrypted</td>
</tr>
<tr>
<td>_http._<em>role</em>._usef.example.com</td>
<td>CNAME record indicating the HTTP endpoint receiving messages for the specified role.This label must not have any resource records of other types (with the exception of the mandatory DNSSEC-related records<sup id="fnref:18"><a class="footnote-ref" href="#fn:18">6</a></sup>) and the alias should resolve to an A or AAAA record<sup id="fnref:19"><a class="footnote-ref" href="#fn:19">7</a></sup>.On the endpoint host, the implementation must listen on the well-known IANA-assigned TCP port for HTTP-over-TLS, i.e. 443.The implementation may listen on port 80 as well, but only for purposes such as supporting the HTTP/2 connection upgrade mechanism and never for unencrypted message exchange.</td>
</tr>
</tbody>
</table>
<h2 id="transmission">Transmission</h2>
<p>Once a valid service endpoint is available, the message enters the transmission stage<sup id="fnref:20"><a class="footnote-ref" href="#fn:20">9</a></sup>.
The implementation will now, for a reasonable amount of time (which is again at least one hour for routine messages, employing exponential back off), attempt to deliver the message to the remote participant.</p>
<p>Messages are sent using a HTTP POST operation with the text/xml<sup id="fnref:21"><a class="footnote-ref" href="#fn:21">10</a></sup> content type, the UTF8 character set and content-length indication.
The request URI depends on the USEF implementation level and host name listed in DNS by the recipient.
For USEF 2019 and the host <code>example.com</code>, it will be <a href="https://example.com/USEF/2019/SignedMessage">https://example.com/USEF/2019/SignedMessage</a>.</p>
<p>Message content consists of a simple wrapper message, specified as SignedMessage in the USEF XML XSD, available for download from the public USEF web site<sup id="fnref:22"><a class="footnote-ref" href="#fn:22">12</a></sup> at <a href="https://usef.info/schema/2019and">https://usef.info/schema/2019and</a> documented in section <a href="../../message-descriptions/message-catalog/">Message catalog</a>.
All usual protocol conventions should be followed during this stage.
For example, when using HTTP version 1.1, redirects (responses with status code 3xx) should be honored in order to support load balancing.
Any server errors (responses with status code 5xx), unknown response status codes,  and connection timeouts and resets should be considered temporary failures and delivery should be re-attempted later within the timeout period.
Only client success or failure messages (responses with status code 200 or a non-ambiguous<sup id="fnref:23"><a class="footnote-ref" href="#fn:23">13</a></sup> 4xx status code, respectively) should be considered final.
This is standard HTTP 1.1 behavior, as fully described in IETF RFC 2616 <sup id="fnref:B7"><a class="footnote-ref" href="#fn:B7">11</a></sup>.</p>
<h2 id="error-handling">Error handling</h2>
<p>In the transmission stage, the guidelines for error handling are as follows:</p>
<p>Until the point that the message has been successfully validated against the USEF XML schema, errors are communicated using transport protocol mechanisms, e.g. HTTP status codes.
For the HTTP protocol, the following error conditions are common (note that, depending on the server and libraries used, some of these may be handled automatically):</p>
<table>
<thead>
<tr>
<th>Condition</th>
<th>Status code</th>
<th>Error type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Missing Content-Length header</td>
<td>411 Length Required</td>
<td>Permanent (E cannot be resolved without changes to the sending implementation)</td>
</tr>
<tr>
<td>Invalid Content-Type header (not text/xml) or character set (default: utf-8)</td>
<td>400 Bad Request</td>
<td>Permanent</td>
</tr>
<tr>
<td>Originating IP address is sending messages at a rate exceeding receiver policy</td>
<td>429 Too Many Requests</td>
<td>Temporary</td>
</tr>
<tr>
<td>Body XML cannot be parsed or is not compliant with USEF XML schema</td>
<td>400 Bad Request</td>
<td>Permanent</td>
</tr>
<tr>
<td>Failed to look up the sender’s public signature key in DNS</td>
<td>419 Authentication Timeout</td>
<td>Temporary (message can be processed when DNS is corrected/replicated)</td>
</tr>
<tr>
<td>Invalid signature (inner XML message cannot be unsealed, for example due to NaCl’s crypto_sign_open function failing)</td>
<td>401 Unauthorized</td>
<td>Permanent (since no authorization schemes that would allow the request to be resubmitted are available, unless private arrangements between sender and recipient exist)</td>
</tr>
<tr>
<td>Unsealed body XML cannot be parsed or is not compliant with the USEF XML schema</td>
<td>400 Bad Request</td>
<td>Permanent</td>
</tr>
</tbody>
</table>
<p>Once a message has been determined to be valid USEF XML, errors are reported using a USEF XML response message with a successful transport disposition (e.g. HTTP status code 200 OK). Possible results in this stage are:</p>
<p>As in the service discovery stage, messages for which transmission permanently fails are removed from the outgoing queue and returned to the sending process, indicating a transport error.</p>
<h3 id="common-message-metadata">Common Message Metadata</h3>
<p>The USEF XML message obtained after successfully verifying the signature will have a root node corresponding to its message type, which must contain Metadata attributes common to all messages used by the implementation to process the message.
The metadata attributes are defined in <a href="../../message-descriptions/message-catalog/metadata-attributes/">metadata attributes</a>.</p>
<h2 id="awaiting-reply">Awaiting reply</h2>
<p>If message transmission succeeds, the implementation starts waiting for a reply from the remote service.
Although replies to some messages can be expected immediately, other USEF messages may only elicit a response several hours later.
In any case, responses are always decoupled from requests and implementations should be strictly asynchronous, correlating requests and responses using their conversation identifier.</p>
<p>Because of the asynchronous nature of message exchange, a process needs to be in place for handling messages that do not receive a (timely) reply.
When preparing a new message, the implementation should specify the message class, as well as the time period within which a reply is expected.
The following message classes are defined:</p>
<p>Incoming replies are validated using the steps outlined in the transmission stage.
Where a reply is rejected, the pending outgoing message remains in the awaiting reply stage until it expires, and any additional manual processing is completed.
Messages for which, ultimately, no reply is received are returned to the sending process, indicating expiry.</p>
<h2 id="service-process-message-error-handling">Service process message error handling</h2>
<p>Since the message exchange process is responsible for transparently handling most, if not all, transient error conditions, service processes have no need for routine error recovery.
In fact, any transport errors reported to the service layer are of such a severe nature that they most likely cannot be corrected without implementation or configuration changes:</p>
<ul>
<li>Malformed messages</li>
<li>Entity address or signing key misconfigurationsExpired message, despite following manual recovery procedures for non-routine messages (for routine messages, no recovery is required by design but logging may definitely be appropriate)</li>
</ul>
<p>The suggested error handling strategy for service processes is to mark the affected remote participant (i.e. not try to exchange any future messages with it) and to emit a diagnostic message indicating that manual intervention is required.
After the issue is investigated and resolved, the configuration can be manually updated to re-enable the participant.</p>
<h2 id="ea1-addressing-scheme">EA1 addressing scheme</h2>
<p>In USEF messages, there is often a requirement for a globally unique identity for certain entities.
To meet this requirement, USEF defines the Entity Address (EA).
Each EA consists of a prefix, indicating the addressing scheme, followed by the actual address.
Currently, two addressing schemes are supported:</p>
<ul>
<li>The European Article Number (EAN), commonly used to uniquely identify connection points in the electricity network and therefore a natural identifier to do the same in USEF.
An example of an EA using this scheme is: ean.871685900012636543</li>
<li>The USEF type 1 entity address (EA1) is designed to allow participants to generate unique identifiers for themselves and entities managed by them, without relying on a central authority.</li>
</ul>
<p>The USEF type 1 EA is structured analogous to the iSCSI IQN.
Paraphrasing IETF RFCs 3720 and 3271 <sup id="fnref:B8"><a class="footnote-ref" href="#fn:B8">14</a></sup>: the EA does not define any new naming authorities but uses Internet domain names to ensure global uniqueness.
Furthermore, the EA is constructed to give an organizational naming authority the flexibility to further subdivide the responsibility for name creation to subordinate naming authorities.</p>
<p>This makes the EA format slightly unwieldy but since bandwidth and storage space are not expected to be significant constraints in any USEF implementation, this is considered to be an acceptable tradeoff for not requiring a central authority.
Syntactically, an EA is a variable-length, 7-bit printable ASCII text string containing up to 255 characters.
For example:</p>
<pre><code>ea1.2013-11.info.usef.test:001:002.090807002a&amp;b#
    &lt;- naming authority -&gt; &lt; unique identifier &gt;
</code></pre>
<p>Mostly taken from IETF RFC 3720 <sup id="fnref:B9"><a class="footnote-ref" href="#fn:B9">15</a></sup>, below are the semantics of the various parts of this EA:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ea1</strong></td>
<td>Constant, indicating this is a type 1 USEF entity address</td>
</tr>
<tr>
<td><strong>2013-11</strong></td>
<td>A date code, in yyyy-mm format.  This date must be a date during which the naming authority owned the domain name used in this format, and should be the first month in which the domain name was owned by this naming authority at 00:01 GMT of the first day of the month.  This date code uses the Gregorian calendar.  All four digits in the year must be present.  Both digits of the month must be present, with January == "01" and December == "12".  The dash must be included.</td>
</tr>
<tr>
<td><strong>info.usef.test</strong></td>
<td>The reversed domain name of the naming authority (person or organization) creating this entity address</td>
</tr>
<tr>
<td><strong>001:002.090807002a&amp;b#</strong></td>
<td>A locally unique string, which may contain product types, serial numbers, host identifiers, or software keys (specifically: it may include colons to separate organization boundaries).  With the exception of the colon prefix, the owner of the domain name can assign everything after the reversed domain name as desired. It is the responsibility of the entity that is the naming authority to ensure that the names it assigns are worldwide unique.</td>
</tr>
</tbody>
</table>
<div class="footnote">
<hr/>
<ol>
<li id="fn:13">
<p>If this recommendation is not followed, a compatible implementation should be provided in order to achieve USEF compliance. <a class="footnote-backref" href="#fnref:13" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:14">
<p>Pronounced “salt” and available with extensive documentation from <a href="http://nacl.cr.yp.to/">http://nacl.cr.yp.to/</a>.
Sodium, <a href="https://github.com/jedisct1/libsodium">https://github.com/jedisct1/libsodium</a>, is an extended NaCl derivative with Windows, OS X and Linux platform support and many available language bindings.
Sodium is highly recommended for USEF-compliant implementations. <a class="footnote-backref" href="#fnref:14" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:15">
<p>Whereas typical cryptographic libraries require several steps to implement message encryption or signing, with each step opening the door for fatal programming mistakes, NaCl offers simple high-level functions which take care of everything, dramatically reducing the risk of inadvertent implementation errors. <a class="footnote-backref" href="#fnref:15" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn:16">
<p>Each USEF participant is responsible for publishing its own endpoint and public key information in a self-managed DNS zone.
To prevent man-in-the-middle interference with the published information, use of DNSSEC is mandatory for such zones. <a class="footnote-backref" href="#fnref:16" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
<li id="fn:17">
<p>Usually one public key string will be present, but in order to support key rotation without invalidating in-transit messages, the implementation should list both the old and the new key for a short period of time (e.g. 24 hours) after a key has been replaced <a class="footnote-backref" href="#fnref:17" title="Jump back to footnote 5 in the text">↩</a></p>
</li>
<li id="fn:18">
<p>USEF participants must enable DNSSEC and implementations must use a validating resolver, treating verification failures as temporary errors, eligible for retrying later.
Absent DNSSEC authentication, private key strings must not be relied on, and separate manual secure key exchange is required. <a class="footnote-backref" href="#fnref:18" title="Jump back to footnote 6 in the text">↩</a></p>
</li>
<li id="fn:19">
<p>As per IETF RFC 1034 <sup id="fnref:B14"><a class="footnote-ref" href="#fn:B14">8</a></sup>, implementations must not fail when presented with CNAME chains or loops.
Chains should be followed (to an implementation-defined maximum depth) and any loops or errors treated as temporary. <a class="footnote-backref" href="#fnref:19" title="Jump back to footnote 7 in the text">↩</a></p>
</li>
<li id="fn:B14">
<p>P. Mockapetris, ""Domain names - concepts and facilities", STD 13, RFC 1034," 1987. <a class="footnote-backref" href="#fnref:B14" title="Jump back to footnote 8 in the text">↩</a></p>
</li>
<li id="fn:20">
<p>For messages containing non-public information, this stage transition may also include encryption of message sections using the public encryption key of the remote participant. <a class="footnote-backref" href="#fnref:20" title="Jump back to footnote 9 in the text">↩</a></p>
</li>
<li id="fn:21">
<p>The USEF specification uses XML, since this format is already widely used in the rather conservative energy market, and enjoys wide and mature tooling support (particularly in the area of schema authoring and validation).
Unlike other XML-based initiatives (such as WS-*), lightweight implementations are considered key, and alternate serialization formats (such as JSON) should be viable as well, despite being out of scope of this specification.
If any such alternate message formats are implemented, fallback to XML must be provided as needed, or such implementations will not be USEF-compliant. <a class="footnote-backref" href="#fnref:21" title="Jump back to footnote 10 in the text">↩</a></p>
</li>
<li id="fn:B7">
<p>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, ""Hypertext Transfer Protocol -- HTTP/1.1", RFC 2616," 1999. <a class="footnote-backref" href="#fnref:B7" title="Jump back to footnote 11 in the text">↩</a></p>
</li>
<li id="fn:22">
<p>Please note that USEF makes no warranties whatsoever as to the uninterrupted availability of its web site, and that production services should not rely on the schema being hosted at this location for purposes such as validation: a local copy should be used instead. <a class="footnote-backref" href="#fnref:22" title="Jump back to footnote 12 in the text">↩</a></p>
</li>
<li id="fn:23">
<p>The prime example of an ambiguous HTTP status code is 404 Not Found: since this is commonly returned by front-end servers in case of temporary back-end issues, USEF implementations are encouraged to consider this a temporary error.: <a class="footnote-backref" href="#fnref:23" title="Jump back to footnote 13 in the text">↩</a></p>
</li>
<li id="fn:B8">
<p>Bakke, M., Hafner, J., Hufferd, J., Voruganti, K., and M. Krueger, ""Internet Small Computer Systems Interface (iSCSI) Naming and Discovery", RFC 3721," 2004. <a class="footnote-backref" href="#fnref:B8" title="Jump back to footnote 14 in the text">↩</a></p>
</li>
<li id="fn:B9">
<p>Satran, J., Meth, K., Sapuntzakis, C., Chadalapaka, M., and E. Zeidner, ""Internet Small Computer Systems Interface (iSCSI)", RFC 3720," 2004. <a class="footnote-backref" href="#fnref:B9" title="Jump back to footnote 15 in the text">↩</a></p>
</li>
</ol>
</div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Flex reservation mechanism" class="md-footer__link md-footer__link--prev" href="../flex-reservation-mechanism/">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                Flex reservation mechanism
              </div>
</div>
</a>
<a aria-label="Next: Bibliography" class="md-footer__link md-footer__link--next" href="../bibliography/">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                Bibliography
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright 2020-2023 Contributors to the Shapeshifter project
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/shapeshifter" rel="noopener" target="_blank" title="GitHub organization of Shapeshifter">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
<a class="md-social__link" href="https://lfenergy.slack.com/channels/shapeshifter" rel="noopener" target="_blank" title="LFEnergy Slack channel #shapeshifter">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1s21.16-47.06 47.06-47.06h47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06S448 171 448 196.9s-21.16 47.06-47.06 47.06h-47.06zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06S309 480 283.1 480s-47.06-21.16-47.06-47.06v-47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06s21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06z"></path></svg>
</a>
<a class="md-social__link" href="https://lists.lfenergy.org/g/shapeshifter-discussion" rel="noopener" target="_blank" title="Mailinglist shapeshifter-discussion">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"></path></svg>
</a>
<a class="md-social__link" href="https://wiki.lfenergy.org/display/SHAP/" rel="noopener" target="_blank" title="Project wiki page">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="m640 51.2-.3 12.2c-28.1.8-45 15.8-55.8 40.3-25 57.8-103.3 240-155.3 358.6H415l-81.9-193.1c-32.5 63.6-68.3 130-99.2 193.1-.3.3-15 0-15-.3C172 352.3 122.8 243.4 75.8 133.4 64.4 106.7 26.4 63.4.2 63.7c0-3.1-.3-10-.3-14.2h161.9v13.9c-19.2 1.1-52.8 13.3-43.3 34.2 21.9 49.7 103.6 240.3 125.6 288.6 15-29.7 57.8-109.2 75.3-142.8-13.9-28.3-58.6-133.9-72.8-160-9.7-17.8-36.1-19.4-55.8-19.7V49.8l142.5.3v13.1c-19.4.6-38.1 7.8-29.4 26.1 18.9 40 30.6 68.1 48.1 104.7 5.6-10.8 34.7-69.4 48.1-100.8 8.9-20.6-3.9-28.6-38.6-29.4.3-3.6 0-10.3.3-13.6 44.4-.3 111.1-.3 123.1-.6v13.6c-22.5.8-45.8 12.8-58.1 31.7l-59.2 122.8c6.4 16.1 63.3 142.8 69.2 156.7L559.2 91.8c-8.6-23.1-36.4-28.1-47.2-28.3V49.6l127.8 1.1z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.action.edit", "navigation.indexes", "navigation.footer", "navigation.top"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "development", "provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>